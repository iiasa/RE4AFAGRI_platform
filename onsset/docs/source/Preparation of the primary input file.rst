Preparation of the primary input file
======================================

The basis of an electrification analysis with **gep_onsset** is the geo-location of population or settlements. Distribution of population might be available as a raster layer (e.g. `WorldPop <https://www.worldpop.org/>`_) or as vector layer (`SEDAC <https://sedac.ciesin.columbia.edu/data/set/grump-v1-settlement-points/data-download>`_).

Creating population "clusters"
##########################################

In GEP, we have processed existing population datasets (and `HRSL <https://data.humdata.org/dataset/highresolutionpopulationdensitymaps>`_ in particular) to create population "clusters". A cluster is a bundle of pixelated areas in close proximity to each other that merge and create a vector polygon. Clusters - in contract to gridded population - have various geometries and sizes and therefore better reflect the geography and behaviour of human settmements. 

You may find more information on the underlying methodology in `this publication <https://www.mdpi.com/1996-1073/12/7/1395>`_. The methodology is also available for testing and experimentation in the form of an open source `Qgis plugin <https://github.com/global-electrification-platform/Clustering>`_. Population clusters developed for Sub-Saharan African countries are openly accecible via `this link <https://data.mendeley.com/datasets/z9zfhzk8cr/3>`_.

 .. note::

    Although clusters improve the geographic representation of human settlements, their development process comes with its own caveats. For example, densily populated urban areas tend to create big population conglomerates that defy the logic of granular analysis that geo-spatial electrification modelling might bring. You may read more in this `publication <upcoming publication>`_.   

Adding attributes to population settlements
##############################################

Regardless of the source's format, the population layer is eventually converted into a point layer; each point representing the center of the area it covers. In order to prepare the primary input file to **gep_onsset** the values of the foundamental GIS datasets (see previous section) need to be extracted and attributed to each settlement (or point) respectively. 

The extraction process can be executed manually in any GIS environment. This however, involves various commands depending on the type of attribute to be extracted (e.g. Zonal statistics, Raster value to points, nearest neighbor etc.). 

Therefore, a `Qgis plugin <https://github.com/global-electrification-platform/Cluster-based_extraction_OnSSET>`_ has been developed to automate this process. The plugin comes with installation and how-to-use instructions that allow easy replication of the process for an area of interest.

.. note::
	In case gridded (raster) population is used instead of clusters in the first place, the extraction process may be executed via a modified version of the Qgis Plugin available in `this repository <https://github.com/KTH-dESA/Raster-based_extraction_OnSSET>`_. 

Example of the primary input file
##########################################
This process creates the primary input file for the **gep_onsset** model. The Qgis plugin exports the result in the form of a .csv file. An example of how this file should look like, is available `here <https://github.com/global-electrification-platform/gep-onsset/tree/master/test_data>`_ (as Malawi.csv). 

.. note::

	The number of columns may differ depending on the GIS layer availability (see previous section). Below follows an example of what one shall expect. In case they are not, you may re-visit the extraction process or add the missing layer.

+----+---------------------------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|  # | Column                          |       Unit      | Description                                                                                                                                                                                                                                                                                                                                |
+====+=================================+=================+============================================================================================================================================================================================================================================================================================================================================+
|  1 | Country                         |       name      | Name of the country in focus (e.g. Malawi)                                                                                                                                                                                                                                                                                                 |
+----+---------------------------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|  2 | NightLights                     |  nW cm^−2 sr^−1 | Average yearly value of stable night lights luminosity. Value   is used (together with other parameters) to identify current electrification   status of the settlement.                                                                                                                                                                   |
+----+---------------------------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|  3 | Pop                             |      people     | Number of people living in the settlement, as retrieved from   the GIS data source (without calibration)                                                                                                                                                                                                                                   |
+----+---------------------------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|  4 | id                              |      number     | Unique identifier of each settlement                                                                                                                                                                                                                                                                                                       |
+----+---------------------------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|  5 | GridCellArea                    |      sq.km      | Area of the settlement; retrieved from population cluster   development and processing                                                                                                                                                                                                                                                     |
+----+---------------------------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|  6 | ElecPop                         |      people     | Number of people with access to electricity in the base year;   Value is retrieved from the cluster development process                                                                                                                                                                                                                    |
+----+---------------------------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|  7 | WindVel                         |       m/s       | Yearly average wind speed in the area of the settlement                                                                                                                                                                                                                                                                                    |
+----+---------------------------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|  8 | GHI                             |   kWh/m^2/year  | Yearly average Global Horizontal Irradiation in the area of   the settlement                                                                                                                                                                                                                                                               |
+----+---------------------------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|  9 | TravelHours                     |      hours      | Travel time to nearest town of 50k people; in the case of   (polygon) clusters this value represents the minimum distance at any   direction                                                                                                                                                                                               |
+----+---------------------------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 10 | Elevation                       |        m        | Above sea level; in the case of cluster this value reflects   the average elevation in the area of the settlement                                                                                                                                                                                                                          |
+----+---------------------------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 11 | Slope                           |       deg       | A product of DEM indicating terrain slope; in the case of   cluster this value reflects the average slope in the area of the settlement                                                                                                                                                                                                    |
+----+---------------------------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 12 | ResidentialDemandTIerCustom     | kWh/capita/year | Electricity demand target based on a custom-based, bottom up   approach (if available)                                                                                                                                                                                                                                                     |
+----+---------------------------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 13 | LandCover                       |     1 to 15     | Type of land cover as defined by the source data; refer to   documentation                                                                                                                                                                                                                                                                 |
+----+---------------------------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 14 | SubstationDist                  |        km       | Distance to nearest sub-station; based on best available GIS   data sources in the base year; in the case of (polygon) clusters this value   represents the minimum distance at any direction                                                                                                                                              |
+----+---------------------------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 15 | CurrentHVLineDist               |        km       | Distance to nearest HV line; based on best available GIS data   sources in the base year; in the case of (polygon) clusters this value   represents the minimum distance at any direction                                                                                                                                                  |
+----+---------------------------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 16 | CurrentMVLineDist               |        km       | Distance to nearest MV line; based on best available GIS data   sources in the base year; in the case of (polygon) clusters this value   represents the minimum distance at any direction                                                                                                                                                  |
+----+---------------------------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 17 | RoadDist                        |        km       | Distance to nearest (primary/secondary) road; based on best   available GIS data in source in the base year; in the case of (polygon)   clusters this value represents the minimum distance at any direction                                                                                                                               |
+----+---------------------------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 18 | X_deg                           |       deg       | Longitude                                                                                                                                                                                                                                                                                                                                  |
+----+---------------------------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 19 | Y_deg                           |       deg       | Latitude                                                                                                                                                                                                                                                                                                                                   |
+----+---------------------------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 20 | TransformerDist                 |        km       | Distance to nearest service transformer; based on best   available GIS data sources in the base year; in the case of (polygon)   clusters this value represents the minimum distance at any direction                                                                                                                                      |
+----+---------------------------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 21 | PlannedMVLineDist               |        km       | Distance to nearest planned MV line; based on best available   GIS data; in the case of (polygon) clusters this value represents the minimum   distance at any direction                                                                                                                                                                   |
+----+---------------------------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 22 | PlannedHVLineDist               |        km       | Distance to nearest planned HV line; based on best available   GIS data; in the case of (polygon) clusters this value represents the minimum   distance at any direction                                                                                                                                                                   |
+----+---------------------------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 23 | HydropowerDist                  |        km       | Distance to nearest site with identified small scale   hydropower potential                                                                                                                                                                                                                                                                |
+----+---------------------------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 24 | Hydropower                      |        kW       | Technical potential of the nearest small scale hydropower site                                                                                                                                                                                                                                                                             |
+----+---------------------------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 25 | HydropowerFID                   |      number     | Unique identified of the nearest small scale hydropower site                                                                                                                                                                                                                                                                               |
+----+---------------------------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 26 | IsUrban                         |      0,1,2      | Indicates Urban/Rural status of the settlement; 2: urban, 1   and 0: rural; 0 refers to small rural settlements while 1 in larger rural   settlements or peri-urban areas, but the model does not differentiate                                                                                                                            |
+----+---------------------------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 27 | PerCapitaDemand                 | kWh/capita/year | Electricity demand target based on urban/rural status and   targets set for each type of settlement                                                                                                                                                                                                                                        |
+----+---------------------------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 28 | HealthDemand                    |     kWh/year    | Electricity demand target to support health related activities   in the settlemenent                                                                                                                                                                                                                                                       |
+----+---------------------------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 29 | EducationDemand                 |     kWh/year    | Electricity demand target to support education related   activities in the settlemenent                                                                                                                                                                                                                                                    |
+----+---------------------------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 30 | AgriDemand                      |     kWh/year    | Electricity demand target to support agriculture related   activities in the settlemenent                                                                                                                                                                                                                                                  |
+----+---------------------------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 31 | ElectrificationOrder            |      number     | Indicates the loop in which the settlement gets electrified;   serves only developer purposes                                                                                                                                                                                                                                              |
+----+---------------------------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 32 | Conflict                        |       0-4       | Indicates conflict level, which in turn affects costing of   electrification; 0: no conflict 4: total unrest; parameter is not used in the   GEP                                                                                                                                                                                           |
+----+---------------------------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 33 | CommercialDemand                | kWh/capita/year | Electricity demand target to support commercial activities in   the settlement                                                                                                                                                                                                                                                             |
+----+---------------------------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 34 | ResidentialDemandTier1          | kWh/capita/year | Electricity demand target for Tier 1                                                                                                                                                                                                                                                                                                       |
+----+---------------------------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 35 | ResidentialDemandTier2          | kWh/capita/year | Electricity demand target for Tier 2                                                                                                                                                                                                                                                                                                       |
+----+---------------------------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 36 | ResidentialDemandTier3          | kWh/capita/year | Electricity demand target for Tier 3                                                                                                                                                                                                                                                                                                       |
+----+---------------------------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 37 | ResidentialDemandTier4          | kWh/capita/year | Electricity demand target for Tier 4                                                                                                                                                                                                                                                                                                       |
+----+---------------------------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 38 | ResidentialDemandTier5          | kWh/capita/year | Electricity demand target for Tier 5                                                                                                                                                                                                                                                                                                       |
+----+---------------------------------+-----------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+